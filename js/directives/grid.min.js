(function(f,e){var h=f.module("ngfur.grid.directives",[]);f.module("ngfur.grid",["ngfur.grid.directives"]);h.directive("grid",function(){return{restrict:"E",scope:{columns:"=",dataprovider:"=",sortFunction:"@"},templateUrl:"js/directives/gridtemplate.html",controller:["$scope","$element","$attrs","$filter",function(a,e,f,g){a.ctrlKey=!1;a.shiftKey=!1;a.selection={};a.prevRow=null;a.sortCol=null;a.sortReverse=!1;a.selectRow=function(c){a.ctrlKey||a.shiftKey||(a.selection={});if(a.ctrlKey)a.selection[this.row.$$hashKey]=
a.selection[this.row.$$hashKey]?!1:!0;else if(a.shiftKey){if(a.prevRow)for(min=Math.min(this.$index,a.prevRow.$index),max=Math.max(this.$index,a.prevRow.$index),this.$index>a.prevRow.$index?min++:max--,c=min;c<=max;c++)a.selection[a.dataprovider[c].$$hashKey]=a.selection[a.dataprovider[c].$$hashKey]?!1:!0}else a.selection[this.row.$$hashKey]=!0;a.prevRow=this;var b=[],k=a.dataprovider.length;for(c=0;c<k;c++)a.selection[a.dataprovider[c].$$hashKey]&&b.push(a.dataprovider[c]);a.$emit("gridSelectionChanged",
b)};a.resetSort=function(){null!=a.sortCol&&(a.dataprovider=g("orderBy")(a.dataprovider,this.sortCol,a.sortReverse))};a.sortColumn=function(){a.sortReverse=a.sortCol==this.col.value?!a.sortReverse:!1;a.sortCol=this.col.value;this.col.hasOwnProperty("sortFunction")?a.dataprovider=g("orderBy")(a.dataprovider,this.col.sortFunction,a.sortReverse):"undefined"==typeof a.sortFunction&&(a.dataprovider=g("orderBy")(a.dataprovider,this.col.value,a.sortReverse))}}],link:function(a,f,h,g){a.$watch("columndef",
function(b){if(b&&0<b.length)if(a.autoWidth)for(var c=Math.floor(99/b.length),d=0;d<b.length;d++)e(".fur-col-"+b[d].value).css("width",+c+"%");else for(d=0;d<b.length;d++)e(".fur-col-"+b[d].value).css("width",null)},!0);a.$watch("columns",function(b){var c=[];if(e.isArray(b))for(var d=0;d<b.length;d++)"string"==typeof b[d]?c.push({label:b[d],value:b[d]}):c.push(b[d]);a.autoWidth=!1;a.columndef=c},!0);a.$watch("dataprovider",function(b){if(b&&0<b.length&&0==a.columndef.length){var c=[],d;for(d in b[0])c.push({label:d,
value:d});a.autoWidth=!0;a.columndef=c}a.resetSort()},!0);var c=function(b){if("keydown"==b.type){if(b.ctrlKey||b.metaKey)a.ctrlKey=!0;b.shiftKey&&(a.shiftKey=!0)}else a.ctrlKey=!1,a.shiftKey=!1};e("body").on("keydown keyup",c);a.$on("$destroy",function(){e("body").off("keydown keyup",c)})}}})})(angular,jQuery);